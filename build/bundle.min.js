var App=App||{};!function(){App.spendingCategories=["Cash","Equipment","Scholarship","Stipend","Other","Paid Internships","Emp. Hours","Total"],App.initialize=function(){$(".header-title").click(function(){hasher.setHash("")})},App.initHome=function(){var t=d3.select(".academy-table"),e=t.select("thead tr"),a=t.select("tbody");e.selectAll("td").data(["Academy"].concat(App.spendingCategories)).enter().append("td").text(function(t){return t});for(var n=a.selectAll("tr").data(App.academies),r=n.enter().append("tr"),i=0;i<App.spendingCategories.length+1;i++)r.append("td");n.on("click",function(t){hasher.setHash("academy/"+t.id)});for(var i=0;i<App.spendingCategories.length+1;i++){var o=n.select("td:nth-child("+(i+1)+")");0===i?o.text(function(t){return t["Academy Name"]+" ("+t["High School"]+")"}):o.text(function(t){return Util.monetize(t[App.spendingCategories[i-1]])})}n.exit().remove()}}();var Routing={};!function(){var t={};Routing.precompileTemplates=function(){$("script[type='text/x-handlebars-template']").each(function(e,a){t[a.id.replace("-template","")]=Handlebars.compile($(a).html())})},Routing.initializeRoutes=function(){crossroads.addRoute("/",function(){a("home"),App.initHome(),window.scrollTo(0,0)}),crossroads.addRoute("/academy/{id}",function(t){a("academy"),App.initAcademy(t),window.scrollTo(0,0)}),crossroads.addRoute("/sector/{name}",function(t){a("sector"),App.initSector(t),window.scrollTo(0,0)}),hasher.prependHash="",hasher.initialized.add(e),hasher.changed.add(e),hasher.init()};var e=function(t){crossroads.parse(t)},a=function(e,a){$("#page-content").html(t[e](a))}}();var Util={};Util.monetize=d3.format("$,f"),Util.assignId=function(t){for(var e=0;e<t.length;e++)t[e].id=e},Util.strToFloat=function(t){return"string"!=typeof t?t:parseFloat(t.replace(/[^\d\.\-]/g,""))},Util.getUnique=function(t){for(var e=[],a=0;a<t.length;a++)-1===e.indexOf(t[a])&&e.push(t[a]);return e};var App=App||{};!function(){App.initAcademy=function(t){var e=d3.select(".academy-select").on("change",function(){var t=$(this).val(),e=App.academies.filter(function(e){return e.id===+t})[0];n(e),m(e)});e.selectAll("option").data(App.academies).enter().append("option").property("value",function(t){return t.id}).text(function(t){return t["Academy Name"]+" ("+t["High School"]+")"});var a=App.academies.filter(function(e){return e.id===+t})[0],n=function(t){$(".academy-name-text").text(t["Academy Name"]),$(".academy-high-school-text").text(t["High School"]),$(".academy-district-text").text(t["School District"]),$(".academy-sector-text").text(t["Primary CTE Industry Sector"]),$(".academy-county-text").text(t.County),$(".academy-sector-text").click(function(){hasher.setHash("sector/"+t["Primary CTE Industry Sector"])})};n(a);var r={top:30,right:20,bottom:30,left:80},i=960-r.left-r.right,o=400-r.top-r.bottom,s=d3.select(".academy-distribution-chart").attr("width",i+r.left+r.right).attr("height",o+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")"),c=d3.scale.ordinal().domain(App.spendingCategories).rangeRoundBands([0,i],.1),p=d3.svg.axis().scale(c).orient("bottom"),l=(s.append("g").attr("class","x axis").attr("transform","translate(0,"+o+")").call(p),d3.scale.linear().range([o,0])),d=d3.svg.axis().orient("left").tickFormat(Util.monetize).innerTickSize(-i).outerTickSize(0),u=s.append("g").attr("class","y axis"),m=function(t){var e=App.spendingCategories.map(function(e){return Util.strToFloat(t[e])});l.domain([0,d3.max(e)]),d.scale(l),u.call(d);var a=s.selectAll(".bar-group").data(App.spendingCategories),n=a.enter().append("g").attr("class","bar-group");n.append("rect").attr("class","bar").attr("width",c.rangeBand()),n.append("text").attr("x",c.rangeBand()/2),a.transition().attr("transform",function(t){return"translate("+c(t)+",0)"}),a.select("rect").transition().attr("y",function(e){return l(t[e])}).attr("height",function(e){return o-l(t[e])}),a.select("text").transition().attr("y",function(e){return l(t[e])-4}).text(function(e){return Util.monetize(t[e])}),a.exit().remove()};m(a)}}();var App=App||{};!function(){App.initSector=function(t){var e=Util.getUnique(App.academies.map(function(t){return t["Primary CTE Industry Sector"]})),a=d3.select(".sector-select").on("change",function(){var t=$(this).val();n(t),f(t)});a.selectAll("option").data(e).enter().append("option").property("value",function(t){return t}).text(function(t){return t});var n=function(t){$(".sector-name-text").html("<u>Sector</u>: "+t)};n(t);var r={top:20,right:20,bottom:40,left:80},i=960-r.left-r.right,o=400-r.top-r.bottom,s=d3.select(".sector-distribution-chart").attr("width",i+r.left+r.right).attr("height",o+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")"),c=d3.scale.ordinal().domain(App.spendingCategories).rangeRoundBands([0,i],.1),p=d3.svg.axis().scale(c).orient("bottom"),l=(s.append("g").attr("class","x axis").attr("transform","translate(0,"+o+")").call(p),d3.scale.linear().range([o,0])),d=d3.svg.axis().orient("left").tickFormat(Util.monetize).innerTickSize(-i).outerTickSize(0),u=s.append("g").attr("class","y axis"),m=d3.select(".legend").attr("width",500),f=function(t){for(var e=d3.scale.category20(),a=[],n=0;n<App.spendingCategories.length;n++){var r=App.spendingCategories[n],i={name:r,values:[],sum:0};App.academies.filter(function(e){return e["Primary CTE Industry Sector"]===t}).forEach(function(t){var e=Util.strToFloat(t[r]);isNaN(e)||i.values.push({academy:t["Academy Name"]+" ("+t["High School"]+")",category:r,value:e,y0:i.sum,y1:i.sum+=e})}),a.push(i)}l.domain([0,d3.max(a.map(function(t){return t.sum}))]),d.scale(l),u.call(d);var p=s.selectAll(".bar-group").data(a),f=p.enter().append("g").attr("class","bar-group");f.append("g").attr("class","bars"),f.append("text").attr("x",c.rangeBand()/2),p.transition().attr("transform",function(t){return"translate("+c(t.name)+",0)"});var g=p.select(".bars").selectAll(".bar").data(function(t){return t.values});g.enter().append("rect").attr("class","bar").attr("width",c.rangeBand()).each(function(){$(this).tooltipster({trigger:"hover",contentAsHTML:!0,onlyOne:!0,offsetX:c.rangeBand()/2,offsetY:-5})}),g.transition().style("fill",function(t){return e(t.academy)}).attr("y",function(t){return l(t.y1)}).attr("height",function(t){return l(t.y0)-l(t.y1)}).each("end",function(t){var e="";e+='<div class="sector-tooltip-academy">'+t.academy+"</div>",e+='<div class="sector-tooltip-value">'+t.category+": <b>"+Util.monetize(t.value)+"</b></div>",$(this).tooltipster("content",e)}),g.exit().remove(),p.select("text").attr("y",function(t){return l(t.sum)-4}).text(function(t){return Util.monetize(t.sum)}),p.exit().remove();var h=80,v=20;m.attr("height",e.domain().length*v).attr("transform","translate(0,"+(o+80)+")");var y=m.selectAll("g").data(e.domain()),A=y.enter().append("g").attr("transform",function(t,e){return"translate(0,"+v*e+")"});A.append("rect").attr("width",h).attr("height",v),A.append("text").attr("transform","translate("+(h+10)+",15)"),y.select("rect").style("fill",function(t){return e(t)}),y.select("text").text(function(t){return t}),y.exit().remove()};f(t)}}();var App=App||{};!function(){var t="undefined"!=typeof App.academies,e=function(){Util.assignId(App.academies),Util.assignId(App.events),App.initialize(),Routing.precompileTemplates(),Routing.initializeRoutes()};t?e():queue().defer(d3.tsv,"data/academies.tsv").defer(d3.tsv,"data/events.tsv").await(function(t,e,a){App.academies=e,App.events=a})}();