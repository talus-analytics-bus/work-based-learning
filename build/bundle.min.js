var App=App||{};!function(){App.spendingCategories=[{attr:"total",name:"Total"},{attr:"cash",name:"Cash"},{attr:"equipment",name:"Equipment"},{attr:"scholarship",name:"Scholarship"},{attr:"stipend",name:"Stipend"},{attr:"other",name:"Other"},{attr:"paid_internship",name:"Paid Internships"},{attr:"emp_hours",name:"Emp. Hours"}],App.payRate=11.7,App.initialize=function(){$(".header-title").click(function(){hasher.setHash("")})},App.loadData=function(t){"undefined"==typeof App.academies?(NProgress.start(),queue().defer(App.getData,"academies").defer(App.getData,"districts").defer(App.getData,"employers").defer(App.getData,"events").await(function(e,r,n,a,o){App.academies=r,App.districts=n,App.employers=a,App.events=o;var i=App.academies.map(function(t){return t.primary_cte_industry}).filter(function(t){return"#N/A"!==t});App.sectors=Util.getUnique(i).sort();for(var s=0;s<App.employers.length;s++){var l=App.employers[s].Employer;App.employers[s].events=[];for(var c=0;c<App.events.length;c++)App.events[c].Employer===l&&App.employers[s].events.push(App.events[c])}Util.assignId(App.academies),Util.assignId(App.events),Util.assignId(App.districts),Util.assignId(App.employers),NProgress.done(),t()})):t()},App.initList=function(){var t=d3.select(".academy-table"),e=t.select("thead tr"),r=t.select("tbody");e.selectAll("td").data(["Academy"].concat(App.spendingCategories)).enter().append("td").text(function(t){return t});for(var n=r.selectAll("tr").data(App.academies),a=n.enter().append("tr"),o=0;o<App.spendingCategories.length+1;o++)a.append("td");n.on("click",function(t){hasher.setHash("academy/"+t.id)});for(var o=0;o<App.spendingCategories.length+1;o++){var i=n.select("td:nth-child("+(o+1)+")");0===o?i.text(function(t){return t["Academy Name"]+" ("+t["High School"]+")"}):i.text(function(t){return Util.monetize(t[App.spendingCategories[o-1]])})}n.exit().remove()},App.getEmployerData=function(t){for(var e={},r=0,n=0;n<App.events.length;n++){var a=App.events[n];if("object"==typeof t&&a.academy_name+a.academy_school===t.academy_name+t.high_school||a.school_district===t){var o=a.employer;"undefined"==typeof e[o]&&(e[o]={hours:0,money:0}),e[o].hours+=Util.strToFloat(a.total),e[o].money+=Util.strToFloat(a.cash),e[o].money+=Util.strToFloat(a.equipment),e[o].money+=Util.strToFloat(a.scholarship),e[o].money+=Util.strToFloat(a.stipend),e[o].money+=Util.strToFloat(a.other),e[o].money+=Util.strToFloat(a.internship_hours)*App.payRate,e[o].hours>r&&(r=e[o].hours)}}var i=[];for(var o in e)i.push({employer:o,hours:e[o].hours,money:e[o].money,value:e[o].hours,percOfMax:e[o].hours/r});return i},App.getData=function(t,e,r){var n={table:t};if("function"==typeof e)var r=e;else for(var a in e)n[a]=e[a];$.post("php/get.php",n,function(t){var e=JSON.parse(t);e.hasOwnProperty("error")?(console.log(e.error),r(e.error)):r(null,e)})},App.logout=function(){$.get("php/logout.php")}}();var Routing={};!function(){var t={};Routing.precompileTemplates=function(){$("script[type='text/x-handlebars-template']").each(function(e,r){t[r.id.replace("-template","")]=Handlebars.compile($(r).html())})},Routing.initializeRoutes=function(){crossroads.addRoute("/",function(){e("home",App.initHome)}),crossroads.addRoute("/login",function(){r("login"),a("login"),App.initLogin(),window.scrollTo(0,0)}),crossroads.addRoute("/list",function(){e("list",App.initList)}),crossroads.addRoute("/academy/:{id}:",function(t){e("academy",App.initAcademy,t)}),crossroads.addRoute("/sector/:{name}:",function(t){e("sector",App.initSector,t)}),crossroads.addRoute("/district/:{name}:",function(t){e("district",App.initDistrict,t)}),crossroads.addRoute("/employer/:{name}:",function(t){e("employer",App.initEmployer,t)}),hasher.prependHash="",hasher.initialized.add(n),hasher.changed.add(n),hasher.init()};var e=function(t,e,n){$.noty.closeAll(),$.get("php/login_check.php",function(o){var i=$.parseJSON(o);i.error?(hasher.setHash("login"),noty({type:"warning",text:i.error})):App.loadData(function(){r(t),a(t),e(n),window.scrollTo(0,0)})})},r=function(t){var e='<div class="home-link bread-link">Home</div>';"home"!==t&&(e+='&nbsp; > &nbsp;<div class="'+t+'-link bread-link">'+t.charAt(0).toUpperCase()+t.slice(1)+"</div>"),$(".breadcrumbs-bar").html(e),$(".home-link").click(function(){hasher.setHash("")}),$("."+t+"-link").click(function(){hasher.setHash(t)})},n=function(t){crossroads.parse(t)},a=function(e,r){$("#page-content").html(t[e](r))}}();var Util={};Util.comma=d3.format(",.1f"),Util.monetize=d3.format("$,f"),Util.percentize=d3.format(".1%"),Util.assignId=function(t){for(var e=0;e<t.length;e++)t[e].id=e},Util.strToFloat=function(t){return"string"!=typeof t?t:parseFloat(t.replace(/[^\d\.\-]/g,""))},Util.getUnique=function(t){for(var e=[],r=0;r<t.length;r++)-1===e.indexOf(t[r])&&e.push(t[r]);return e};var App=App||{};!function(){App.initAcademy=function(t){if("undefined"==typeof t)var t=0;var e=d3.select(".academy-select").on("change",function(){var t=$(this).val(),e=App.academies.filter(function(e){return e.id===+t})[0];U(e)});e.selectAll("option").data(App.academies).enter().append("option").property("value",function(t){return t.id}).text(function(t){return t.academy_name+" ("+t.high_school+")"}),e.property("value",t);var r=App.academies.filter(function(e){return e.id===+t})[0],n=r,a=function(t){n=t,$(".academy-name-text").text(t.academy_name),$(".academy-high-school-text").text(t.high_school),$(".academy-district-text").text(t.school_district).click(function(){hasher.setHash("district/"+t.school_district)}),$(".academy-sector-text").text(t.primary_cte_industry).click(function(){hasher.setHash("sector/"+t.primary_cte_industry)}),$(".academy-county-text").text(t.county)},o={top:30,right:20,bottom:30,left:80},i=960-o.left-o.right,s=400-o.top-o.bottom,l=d3.select(".academy-distribution-chart").attr("width",i+o.left+o.right).attr("height",s+o.top+o.bottom).append("g").attr("transform","translate("+o.left+","+o.top+")"),c=d3.scale.ordinal().domain(App.spendingCategories.map(function(t){return t.name})).rangeRoundBands([0,i],.3),p=d3.svg.axis().scale(c).orient("bottom"),d=(l.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").call(p),d3.scale.linear().range([s,0])),u=d3.svg.axis().orient("left").tickFormat(Util.monetize).innerTickSize(-i).outerTickSize(0),f=l.append("g").attr("class","y axis"),m=function(t){var e=App.spendingCategories.map(function(e){return Util.strToFloat(t[e.attr])});d.domain([0,1.1*d3.max(e)]),u.scale(d),f.call(u);var r=l.selectAll(".bar-group").data(App.spendingCategories),n=r.enter().append("g").attr("class","bar-group");n.append("rect").attr("class","bar").attr("width",c.rangeBand()),n.append("text").attr("x",c.rangeBand()/2),r.transition().attr("transform",function(t){return"translate("+c(t.name)+",0)"}),r.select("rect").transition().attr("y",function(e){return d(t[e.attr])}).attr("height",function(e){return s-d(t[e.attr])}),r.select("text").transition().attr("y",function(e){return d(t[e.attr])-4}).text(function(e){return Util.monetize(t[e.attr])}),r.exit().remove()},h=function(t,e){if("undefined"==typeof e)var e=$(".event-list-btn-group .btn.active").attr("stat");$(".academy-event-list thead td:nth-child(2)").text("hours"===e?"Hours":"Donations");var r=App.getEmployerData(t);if(r.sort(function(t,r){return+t[e]>+r[e]?-1:+t[e]<+r[e]?1:0}),0===r.length)$(".event-list-container").hide();else{$(".event-list-container").show();for(var n=d3.select(".academy-event-list tbody").selectAll("tr").data(r),a=n.enter().append("tr"),o=0;2>o;o++)a.append("td");n.select("td:first-child").text(function(t){return t.employer}),n.select("td:nth-child(2)").text(function(t){return"hours"===e?Util.comma(t[e]):Util.monetize(t[e])}),n.on("click",function(t){hasher.setHash("employer/"+t.employer)}),n.exit().remove()}};$(".event-list-btn-group .btn").click(function(){var t=$(this);t.addClass("active"),t.siblings().removeClass("active"),h(n,t.attr("stat"))});var g=400,v={top:0,left:80,right:80,bottom:0},y=d3.scale.category20c(),A=d3.layout.pack().sort(null).size([g,g]).padding(1.5),x=d3.select(".employer-bubble-chart").attr("width",g+v.left+v.right).attr("height",g+v.top+v.bottom).append("g").attr("transform","translate("+v.left+","+v.top+")"),b=function(t){var e=App.getEmployerData(t);e=e.filter(function(t){return t.value>0});var r=x.selectAll(".node").data(A.nodes({children:e})),n=r.enter().append("g").attr("class","node").each(function(){$(this).tooltipster({onlyOne:!0,contentAsHTML:!0})});n.append("title"),n.append("circle"),n.append("text"),r.transition().attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).style("display",function(t){return 0===t.depth?"none":"block"}),r.select("title").text(function(t){return t.employer}),r.select("circle").attr("r",function(t){return t.r}).style("fill",function(t){return y(t.employer)}),r.select("text").style("display",function(t){return t.percOfMax<.1?"none":"block"}).html(function(t){return t.employer}),r.on("click",function(t){hasher.setHash("employer/"+t.employer)}),r.each(function(t){var e=$(this);e.tooltipster("option","offsetX",t.r),e.tooltipster("option","offsetY",-t.r),e.tooltipster("content",t.employer)}),r.exit().remove()},U=function(t){a(t),m(t),h(t),b(t)};U(r)}}();var App=App||{};!function(){App.initDistrict=function(t){if("undefined"==typeof t)var t=App.academies[0].school_district;var e=d3.select(".district-select").on("change",function(){var t=$(this).val();n(t),m(t),h(t),b(t)});e.selectAll("option").data(App.districts).enter().append("option").property("value",function(t){return t.school_district}).text(function(t){return t.school_district}),e.property("value",t);var r=t,n=function(t){r=t,$(".district-name-text").html(t);var e=App.academies.filter(function(e){return e.school_district===t}),n=e[0].county;$(".district-county-text").html(n);var a=Util.getUnique(e.map(function(t){return t.high_school}));$(".district-high-school-text").html(a.join(", "))};n(t);var a={top:20,right:20,bottom:40,left:80},o=960-a.left-a.right,i=400-a.top-a.bottom,s=d3.select(".district-distribution-chart").attr("width",o+a.left+a.right).attr("height",i+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")"),l=d3.scale.ordinal().domain(App.spendingCategories.map(function(t){return t.name})).rangeRoundBands([0,o],.3),c=d3.svg.axis().scale(l).orient("bottom"),p=(s.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(c),d3.scale.linear().range([i,0])),d=d3.svg.axis().orient("left").tickFormat(Util.monetize).innerTickSize(-o).outerTickSize(0),u=s.append("g").attr("class","y axis"),f=d3.select(".legend").attr("width",500),m=function(t){for(var e=d3.scale.category20c(),r=[],n=0;n<App.spendingCategories.length;n++){var a=App.spendingCategories[n].attr,o=App.spendingCategories[n].name,c={name:a,catName:o,values:[],sum:0};App.academies.filter(function(e){return e.school_district===t}).forEach(function(t){var e=Util.strToFloat(t[a]);isNaN(e)||c.values.push({academy:t.academy_name+" ("+t.high_school+")",category:a,catName:o,value:e,y0:c.sum,y1:c.sum+=e})}),r.push(c)}p.domain([0,1.1*d3.max(r.map(function(t){return t.sum}))]),d.scale(p),u.call(d);var m=s.selectAll(".bar-group").data(r),h=m.enter().append("g").attr("class","bar-group");h.append("g").attr("class","bars"),h.append("text").attr("x",l.rangeBand()/2),m.transition().attr("transform",function(t){return"translate("+l(t.catName)+",0)"}),m.exit().remove();var g=m.select(".bars").selectAll(".bar").data(function(t){return t.values});g.enter().append("rect").attr("class","bar").attr("width",l.rangeBand()).each(function(){$(this).tooltipster({trigger:"hover",contentAsHTML:!0,onlyOne:!0,offsetX:l.rangeBand()/2,offsetY:-5})}),g.transition().style("fill",function(t){return e(t.academy)}).attr("y",function(t){return p(t.y1)}).attr("height",function(t){return p(t.y0)-p(t.y1)}).each("end",function(t){var e="";e+='<div class="sector-tooltip-academy">'+t.academy+"</div>",e+='<div class="sector-tooltip-value">'+t.catName+": <b>"+Util.monetize(t.value)+"</b></div>",$(this).tooltipster("content",e)}),g.exit().remove(),m.select("text").attr("y",function(t){return p(t.sum)-4}).text(function(t){return Util.monetize(t.sum)});var v=80,y=20;f.attr("height",e.domain().length*y).attr("transform","translate(0,"+(i+80)+")");var A=f.selectAll("g").data(e.domain()),x=A.enter().append("g").attr("transform",function(t,e){return"translate(0,"+y*e+")"});x.append("rect").attr("width",v).attr("height",y),x.append("text").attr("transform","translate("+(v+10)+",15)"),A.select("rect").style("fill",function(t){return e(t)}),A.select("text").text(function(t){return t}),A.exit().remove()};m(t);var h=function(t,e){if("undefined"==typeof e)var e=$(".event-list-btn-group .btn.active").attr("stat");$(".academy-event-list thead td:nth-child(2)").text("hours"===e?"Hours":"Donations");var r=App.getEmployerData(t);if(0===r.length)$(".event-list-container").hide(),$(".empty-event-list-container").show();else{$(".event-list-container").show(),$(".empty-event-list-container").hide(),r.sort(function(t,r){return+t[e]>+r[e]?-1:+t[e]<+r[e]?1:0}),r=r.slice(0,10);for(var n=d3.select(".academy-event-list tbody").selectAll("tr").data(r),a=n.enter().append("tr"),o=0;2>o;o++)a.append("td");n.select("td:first-child").text(function(t){return t.employer}),n.select("td:nth-child(2)").text(function(t){return"hours"===e?Util.comma(t[e]):Util.monetize(t[e])}),n.on("click",function(t){hasher.setHash("employer/"+t.employer)}),n.exit().remove()}};$(".event-list-btn-group .btn").click(function(){var t=$(this);t.addClass("active"),t.siblings().removeClass("active"),h(r,t.attr("stat"))});var g=400,v={top:0,left:80,right:80,bottom:0},y=d3.scale.category20c(),A=d3.layout.pack().sort(null).size([g,g]).padding(1.5),x=d3.select(".employer-bubble-chart").attr("width",g+v.left+v.right).attr("height",g+v.top+v.bottom).append("g").attr("transform","translate("+v.left+","+v.top+")"),b=function(t){var e=App.getEmployerData(t);if(e.length>0){var r=x.selectAll(".node").data(A.nodes({children:e})),n=r.enter().append("g").attr("class","node").each(function(){$(this).tooltipster({onlyOne:!0,contentAsHTML:!0})});n.append("circle"),r.transition().attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).style("display",function(t){return 0===t.depth?"none":"block"}),r.select("circle").attr("r",function(t){return t.r}).style("fill",function(t){return y(t.employer)}),r.on("click",function(t){hasher.setHash("employer/"+t.employer)}),r.each(function(t){var e=$(this);e.tooltipster("option","offsetX",t.r),e.tooltipster("option","offsetY",-t.r),e.tooltipster("content","<div>"+t.employer+"</div><div>"+Util.comma(t.hours)+" hours")}),r.exit().remove()}};h(t),b(t)}}();var App=App||{};!function(){App.initEmployer=function(t){if("undefined"==typeof t)var t="CSET";var e=App.sectors.concat(["Other"]),r=d3.select(".employer-select").on("change",function(){var t=$(this).val();n(t),f(t)});r.selectAll("option").data(App.employers.sort()).enter().append("option").property("value",function(t){return t.employer}).text(function(t){return t.employer}),r.property("value",t);var n=function(t){$(".employer-name-text").text(t);var e=App.employers.filter(function(e){return e.employer===t})[0],r=e.contact_first_name,n=e.contact_last_name,a=e.contact_phone,o=e.contact_email;$(".employer-first-name-text").text(""===r?"No Data":r),$(".employer-last-name-text").text(""===n?"No Data":n),$(".employer-phone-text").text(""===a?"No Data":a),$(".employer-email-text").text(""===o?"No Data":o)};n(t);var a={top:30,right:100,bottom:180,left:80},o=960-a.left-a.right,i=550-a.top-a.bottom,s=d3.select(".employer-distribution-chart").attr("width",o+a.left+a.right).attr("height",i+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")"),l=d3.scale.ordinal().domain(e).rangeRoundBands([0,o],.3),c=d3.svg.axis().scale(l).tickFormat(function(t){return"Manufacturing & Product Design/Engineering & Design"===t?"Manufacturing & Product Design":t}).orient("bottom"),p=(s.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(c),d3.scale.linear().range([i,0])),d=d3.svg.axis().orient("left").tickFormat(Util.comma).innerTickSize(-o).outerTickSize(0),u=s.append("g").attr("class","y axis"),f=(s.append("text").attr("transform","translate(-50, "+i/2+") rotate(-90)").text("# of hours"),function(t){for(var r={},n=0;n<e.length;n++)r[e[n]]=0;for(var n=0;n<App.events.length;n++){var a=App.events[n];if(a.employer===t){var o=a.sector,c=Util.strToFloat(a.total);-1===e.indexOf(o)?isNaN(c)||(r.other+=c):isNaN(c)||(r[o]+=c)}}var f=e.map(function(t){return r[t]}),m=d3.max(f);0===m&&(m=10/11),p.domain([0,1.1*m]),d.scale(p),u.call(d);var h=s.selectAll(".bar-group").data(e),g=h.enter().append("g").attr("class","bar-group");g.append("rect").attr("class","bar").attr("width",l.rangeBand()),g.append("text").attr("x",l.rangeBand()/2),h.transition().attr("transform",function(t){return"translate("+l(t)+",0)"}),h.select("rect").transition().attr("y",function(t){return p(r[t])}).attr("height",function(t){return i-p(r[t])}),h.select("rect").on("click",function(t){hasher.setHash("sector/"+t)}),h.select("text").transition().attr("y",function(t){return p(r[t])-4}).text(function(t){return Util.comma(r[t])}),h.exit().remove(),$(".x.axis .tick text").css("text-anchor","start").attr("transform","rotate(20)")});f(t)}}();var App=App||{};!function(){App.initHome=function(){$(".big-button").click(function(){var t=$(this).attr("page");hasher.setHash(t)});var t={top:40,right:20,bottom:30,left:80},e=900-t.left-t.right,r=400-t.top-t.bottom,n=d3.select(".overall-distribution-chart").attr("width",e+t.left+t.right).attr("height",r+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")"),a=d3.scale.ordinal().domain(App.spendingCategories.map(function(t){return t.name})).rangeRoundBands([0,e],.3),o=d3.svg.axis().scale(a).orient("bottom"),i=(n.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(o),d3.scale.linear().range([r,0])),s=d3.svg.axis().orient("left").tickFormat(Util.monetize).innerTickSize(-e).outerTickSize(0),l=n.append("g").attr("class","y axis"),c=[2212415,348362,600,0,0,44102,130768,1688583],p=2271520;i.domain([0,p]),s.scale(i),l.call(s);var d=n.selectAll(".bar-group").data(App.spendingCategories),u=d.enter().append("g").attr("class","bar-group");u.append("rect").attr("class","bar").attr("width",a.rangeBand()),u.append("text").attr("x",a.rangeBand()/2),d.transition().attr("transform",function(t){return"translate("+a(t.name)+",0)"}),d.select("rect").transition().attr("y",function(t,e){return i(c[e])}).attr("height",function(t,e){return r-i(c[e])}),d.select("text").transition().attr("y",function(t,e){return i(c[e])-4}).text(function(t,e){return Util.monetize(c[e])}),d.exit().remove(),$(".progress-bar").css("width",String(100*c[0]/p)+"%"),$(".progress-text").html(Util.monetize(c[0])+" of "+Util.monetize(p)+" achieved ("+Util.percentize(c[0]/p)+")"),d3.select(".progress-bar-shell").selectAll(".tick-line").data([0,50,100]).enter().append("div").attr("class","tick-line").style("left",function(t){return t+"%"}),d3.select(".progress-bar-shell").selectAll(".tick-text").data([0,50,100]).enter().append("div").attr("class","tick-text").style("left",function(t){return t-10+"%"}).text(function(t){return t+"%"})}}();var App=App||{};!function(){App.initLogin=function(){$(".login-button").click(function(){t()}),$(".password-input").on("keyup",function(e){13===e.which&&t()})};var t=function(){NProgress.start(),$.noty.closeAll();var t=$(".username-input").val(),e=$(".password-input").val();$.get("php/login.php",{username:t,password:e},function(t){console.log(t);var e=$.parseJSON(t);e.error?noty({layout:"top",type:"warning",text:"<b>Error!</b><br>"+e.error}):hasher.setHash(""),NProgress.done()})}}();var App=App||{};!function(){App.initSector=function(r){if("undefined"==typeof r)var r=App.academies[0].primary_cte_industry;var n=d3.select(".sector-select").on("change",function(){var t=$(this).val();o(t),g(t),v(t),k(t),_(t),H(t)});n.selectAll("option").data(App.sectors).enter().append("option").property("value",function(t){return t}).text(function(t){return t}),n.property("value",r);var a=r,o=function(t){a=t,$(".sector-name-text").html(t)};o(r);var i={top:20,right:20,bottom:40,left:80},s=960-i.left-i.right,l=400-i.top-i.bottom,c=d3.select(".sector-distribution-chart").attr("width",s+i.left+i.right).attr("height",l+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),p=d3.scale.ordinal().domain(App.spendingCategories.map(function(t){return t.name})).rangeRoundBands([0,s],.3),d=d3.svg.axis().scale(p).orient("bottom"),u=(c.append("g").attr("class","x axis").attr("transform","translate(0,"+l+")").call(d),d3.scale.linear().range([l,0])),f=d3.svg.axis().orient("left").tickFormat(Util.monetize).innerTickSize(-s).outerTickSize(0),m=c.append("g").attr("class","y axis"),h=d3.select(".legend").attr("width",500),g=function(t){for(var e=d3.scale.category20c().range(["#3182bd","#6baed6","#9ecae1","#c6dbef"]),r=[],n=0;n<App.spendingCategories.length;n++){var a=App.spendingCategories[n].attr,o=App.spendingCategories[n].name,i={name:a,catName:o,values:[],sum:0};App.academies.filter(function(e){return e.primary_cte_industry===t}).forEach(function(t){var e=Util.strToFloat(t[a]);isNaN(e)||i.values.push({academy:t.academy_name+" ("+t.high_school+")",category:a,catName:o,value:e,y0:i.sum,y1:i.sum+=e})}),r.push(i)}u.domain([0,1.1*d3.max(r.map(function(t){return t.sum}))]),f.scale(u),m.call(f);var s=c.selectAll(".bar-group").data(r),d=s.enter().append("g").attr("class","bar-group");d.append("g").attr("class","bars"),d.append("text").attr("x",p.rangeBand()/2),s.transition().attr("transform",function(t){return"translate("+p(t.catName)+",0)"}),s.exit().remove();var g=s.select(".bars").selectAll(".bar").data(function(t){return t.values});g.enter().append("rect").attr("class","bar").attr("width",p.rangeBand()).each(function(){$(this).tooltipster({trigger:"hover",contentAsHTML:!0,onlyOne:!0,offsetX:p.rangeBand()/2,offsetY:-5})}),g.transition().style("fill",function(t){return t.value>0?e(t.academy):void 0}).attr("y",function(t){return u(t.y1)}).attr("height",function(t){return u(t.y0)-u(t.y1)}).each("end",function(t){var e="";e+='<div class="sector-tooltip-academy">'+t.academy+"</div>",e+='<div class="sector-tooltip-value">'+t.catName+": <b>"+Util.monetize(t.value)+"</b></div>",$(this).tooltipster("content",e)}),g.exit().remove(),s.select("text").attr("y",function(t){return u(t.sum)-4}).text(function(t){return Util.monetize(t.sum)});var v=80,y=20;h.attr("height",e.domain().length*y).attr("transform","translate(0,"+(l+80)+")");var A=h.selectAll("g").data(e.domain()),x=A.enter().append("g").attr("transform",function(t,e){return"translate(0,"+y*e+")"});x.append("rect").attr("width",v).attr("height",y),x.append("text").attr("transform","translate("+(v+10)+",15)"),A.select("rect").style("fill",function(t){return e(t)}),A.select("text").text(function(t){return t}),A.exit().remove()};g(r);var v=function(e,r){if("undefined"==typeof r)var r=$(".event-list-btn-group .btn.active").attr("stat");$(".academy-event-list thead td:nth-child(2)").text("hours"===r?"Hours":"Donations");var n=t(e);if(0===n.length)$(".event-list-container").hide();else{$(".event-list-container").show(),n.sort(function(t,e){return+t[r]>+e[r]?-1:+t[r]<+e[r]?1:0}),n=n.slice(0,10);for(var a=d3.select(".academy-event-list tbody").selectAll("tr").data(n),o=a.enter().append("tr"),i=0;2>i;i++)o.append("td");a.select("td:first-child").text(function(t){return t.employer}),a.select("td:nth-child(2)").text(function(t){return"hours"===r?Util.comma(t[r]):Util.monetize(t[r])}),a.on("click",function(t){hasher.setHash("district/"+t.employer)}),a.exit().remove()}};$(".event-list-btn-group .btn").click(function(){var t=$(this);t.addClass("active"),t.siblings().removeClass("active"),v(a,t.attr("stat"))});var y=400,A={top:0,left:80,right:80,bottom:0},x=d3.scale.category20c(),b=d3.layout.pack().sort(null).size([y,y]).padding(1.5),U=d3.select(".employer-bubble-chart").attr("width",y+A.left+A.right).attr("height",y+A.top+A.bottom).append("g").attr("transform","translate("+A.left+","+A.top+")"),k=function(e){var r=t(e),n=U.selectAll(".node").data(b.nodes({children:r})),a=n.enter().append("g").attr("class","node").each(function(){$(this).tooltipster({onlyOne:!0,contentAsHTML:!0})});a.append("circle"),n.transition().attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).style("display",function(t){return 0===t.depth?"none":"block"}),n.select("circle").attr("r",function(t){return t.r}).style("fill",function(t){return x(t.employer)}),n.on("click",function(t){hasher.setHash("district/"+t.employer)}),n.each(function(t){var e=$(this);e.tooltipster("option","offsetX",t.r),e.tooltipster("option","offsetY",-t.r),e.tooltipster("content","<div>"+t.employer+"</div><div><b>"+Util.comma(t.hours)+" hours</b></div>")}),n.exit().remove()};v(r),k(r);var _=function(t){$(".academy-list-container").hide();var r=e(t);if(0===r.length);else{for(var n=d3.select(".sector-academy-list tbody").selectAll("tr").data(r),a=n.enter().append("tr"),o=0;2>o;o++)a.append("td");n.select("td:first-child").text(function(t){return t.employer}),n.select("td:nth-child(2)").text(function(t){return Util.monetize(t.value)}),n.on("click",function(t){var e=App.academies.filter(function(e){return e["Academy Name"]===t.employer})[0].id;hasher.setHash("academy/"+e)}),n.exit().remove()}},T=400,z=d3.scale.category20c(),w=d3.select(".academy-bubble-chart").attr("width",T+A.left+A.right).attr("height",T+A.top+A.bottom).append("g").attr("transform","translate("+A.left+","+A.top+")"),H=function(t){var r=e(t),n=w.selectAll(".node").data(b.nodes({children:r})),a=n.enter().append("g").attr("class","node").each(function(){$(this).tooltipster({onlyOne:!0,contentAsHTML:!0})});a.append("circle"),n.transition().attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).style("display",function(t){return 0===t.depth?"none":"block"}),n.select("circle").attr("r",function(t){return t.r}).style("fill",function(t){return z(t.employer)}),n.on("click",function(t){var e=App.academies.filter(function(e){return e.academy_name===t.employer})[0].id;hasher.setHash("academy/"+e)}),n.each(function(t){var e=$(this);e.tooltipster("option","offsetX",t.r),e.tooltipster("option","offsetY",-t.r),e.tooltipster("content",t.employer)}),n.exit().remove()};_(r),H(r)};var t=function(t){for(var e={},r=0,n=0;n<App.events.length;n++){var a=App.events[n];if(a.sector===t){var o=a.employer;""!==o&&("undefined"==typeof e[o]&&(e[o]={hours:0,money:0}),e[o].hours+=Util.strToFloat(a.total),e[o].money+=Util.strToFloat(a.cash),e[o].money+=Util.strToFloat(a.equipment),e[o].money+=Util.strToFloat(a.scholarship),e[o].money+=Util.strToFloat(a.stipend),e[o].money+=Util.strToFloat(a.other),e[o].money+=Util.strToFloat(a.internship_hours)*App.payRate,e[o].hours>r&&(r=e[o].hours))}}var i=[];for(var o in e)i.push({employer:o,hours:e[o].hours,money:e[o].money,value:e[o].hours,percOfMax:e[o].hours/r});return i},e=function(t){for(var e=App.academies.filter(function(e){return e.primary_cte_industry===t}),r={},n=0,a=0;a<e.length;a++){var o=e[a].academy_name;"undefined"==typeof r[o]&&(r[o]=0),r[o]+=Util.strToFloat(e[a].total),r[o]>n&&(n=r[o])}var i=[];for(var o in r)i.push({employer:o,value:r[o],percOfMax:r[o]/n});return i.sort(function(t,e){return+t.value>+e.value?-1:+t.value<+e.value?1:0}),i}}();var App=App||{};!function(){var t=function(){App.initialize(),Routing.precompileTemplates(),Routing.initializeRoutes()};t()}();